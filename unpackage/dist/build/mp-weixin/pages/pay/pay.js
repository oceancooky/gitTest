(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/pay/pay"],{"00c2":function(t,e,i){"use strict";i.r(e);var s=i("09c3"),a=i("471e");for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);i("697c");var o=i("2877"),c=Object(o["a"])(a["default"],s["a"],s["b"],!1,null,null,null);e["default"]=c.exports},"09c3":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{},[t.address.id?i("navigator",{staticClass:"content padding-content flex-con address more more-b more-r",attrs:{url:"/pages/user/address/address?from=1"}},[i("view",{staticClass:"address-edit"}),i("view",{staticClass:"address-info"},[i("view",{staticClass:"address-name flex-con"},[t._v(t._s(t.address.name)),i("view",{staticClass:"address-phone"},[t._v(t._s(t.address.phone))])]),i("view",{staticClass:"address-detail flex-con"},[t._v(t._s(t.address.address))])])]):i("navigator",{staticClass:"content padding-content flex-con address more more-b more-r",attrs:{url:"/pages/user/address/newaddress/newaddress?from=1"}},[i("view",{staticClass:"address-edit"}),i("view",{staticClass:"address-info"},[i("view",{staticClass:"address-detail flex-con"},[t._v("请添加一个地址")])])]),i("view",{staticClass:"content martop20 padding-content orders-goods-wrap"},t._l(t.goods,function(t,e){return i("view",{key:e,staticClass:"order-item-goods"},[i("goodsCard",{attrs:{goodsinfo:t,mpcomid:"bb373126-0-"+e}})],1)})),i("view",{staticClass:"content padding-content menu menu-title remark"},[t._v("留言:"),i("input",{attrs:{type:"text",value:"",placeholder:"选填, 请填写其他需求",eventid:"bb373126-0"},on:{input:t.getRemark}})]),i("view",{staticClass:"content padding-content menu menu-title more more-b more-r invoice",attrs:{eventid:"bb373126-1"},on:{tap:t.setInvoice}},[t._v("发票"),i("view",[t._v(t._s(t.invoiceText))])]),i("view",{staticClass:"content padding-top20"},[i("view",{staticClass:"info-item flex-con justify-bet"},[t._v("商品金额"),i("view",[t._v("￥"+t._s(t.order.goods_total?t.order.goods_total:0))])]),t._m(0),i("view",{staticClass:"info-item flex-con justify-bet"},[t._v("运费"),i("view",[t._v("￥"+t._s(t.order.freight?t.order.freight:0))])])]),i("view",{staticClass:"bottom-menu fix-bottom"},[i("view",{staticClass:"bottom-menu-con flex-con justify-bet"},[i("view",{staticClass:"total flex-con"},[t._v("合计"),i("view",{staticClass:"flex-con total-price"},[i("view",{staticClass:"total-price-sym"},[t._v("￥")]),t._v(t._s(t.order.amount?t.order.amount:0))])]),i("button",{attrs:{eventid:"bb373126-2"},on:{tap:t.generateOrder}},[t._v("提交订单")])],1)]),t.popUp||t.isInvoice?i("view",{staticClass:"popup",attrs:{eventid:"bb373126-3"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.moveHandle(e)},tap:t.noInvoice}}):t._e(),i("view",{staticClass:"select-pop",class:{active:t.popUp},attrs:{eventid:"bb373126-5"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.moveHandle(e)}}},[i("view",{staticClass:"close-btn",attrs:{eventid:"bb373126-4"},on:{tap:t.noInvoice}})]),i("view",{staticClass:"select-pop",class:{active:t.isInvoice},attrs:{eventid:"bb373126-11"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.moveHandle(e)}}},[i("view",{staticClass:"close-btn",attrs:{eventid:"bb373126-6"},on:{tap:t.noInvoice}}),i("view",{staticClass:"padding-top20 flex-con font-bold justify-center pay-title"},[t._v("选择发票")]),i("form",{attrs:{eventid:"bb373126-10"},on:{submit:t.formSubmit}},[i("scroll-view",{staticClass:"scrollInvoice",attrs:{"scroll-y":"true"}},[i("view",{staticClass:"selec-title padding-content martop20 font-bold flex-con justify-bet"},[t._v("发票类型")]),i("view",{staticClass:"padding-top20 flex-con"},[i("view",{staticClass:"invoice-type invoice_sel"},[t._v("电子发票")]),i("view",{staticClass:"invoice-type"},[t._v("纸质发票")])]),i("view",{staticClass:"selec-title padding-content font-bold flex-con justify-bet"},[t._v("抬头类型")]),i("view",{staticClass:"padding-top20 flex-con"},[i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:1==t.invoiceType},attrs:{eventid:"bb373126-7"},on:{tap:function(e){t.changeInvType(1)}}},[t._v("单位")]),i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:2==t.invoiceType},attrs:{eventid:"bb373126-8"},on:{tap:function(e){t.changeInvType(2)}}},[t._v("个人")])]),i("view",{staticClass:"padding-content invoice-box"},[i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[i("text",[t._v("*")]),t._v("发票抬头:")]),i("input",{attrs:{type:"text",placeholder:"抬头名称",name:"title"}})]),1==t.invoiceType?i("block",[i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[i("text",[t._v("*")]),t._v("税号:")]),i("input",{attrs:{type:"idcard",placeholder:"纳税人识别号",name:"tax_no"}})]),i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[t._v("开户银行:")]),i("input",{attrs:{type:"text",placeholder:"选填",name:"bank"}})]),i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[t._v("银行账号:")]),i("input",{attrs:{type:"number",placeholder:"选填",name:"bank_no"}})]),i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[t._v("企业地址:")]),i("input",{attrs:{type:"text",placeholder:"选填",name:"address"}})]),i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[t._v("企业电话:")]),i("input",{attrs:{type:"number",placeholder:"选填",name:"phone"}})])]):t._e(),i("view",{staticClass:"menu more more-b",attrs:{eventid:"bb373126-9"},on:{tap:t.noInvoice}},[i("view",{staticClass:"menu-name"},[t._v("本次不开具发票,继续下单")])])],1)]),i("button",{staticClass:"big-btn confirmbtn",attrs:{formType:"submit"}},[t._v("确定")])],1)],1),i("loading",{attrs:{isLoading:t.isLoading,mpcomid:"bb373126-1"}})],1)},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"info-item flex-con justify-bet"},[t._v("支付方式"),i("view",[t._v("现金")])])}];i.d(e,"a",function(){return s}),i.d(e,"b",function(){return a})},"471e":function(t,e,i){"use strict";i.r(e);var s=i("a40d"),a=i.n(s);for(var n in s)"default"!==n&&function(t){i.d(e,t,function(){return s[t]})}(n);e["default"]=a.a},"4dfc":function(t,e,i){},"697c":function(t,e,i){"use strict";var s=i("4dfc"),a=i.n(s);a.a},a40d:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=n(i("fa81")),a=n(i("3764"));function n(t){return t&&t.__esModule?t:{default:t}}var o={components:{goodsCard:s.default,loading:a.default},data:function(){return{popUp:!1,isInvoice:!1,order:{},goods:[],address:{},remark:"",isUpdate:!1,invoiceType:1,invoiceData:{},invoiceText:"本次不开具发票",isLoading:!1}},onShow:function(){this.isUpdate&&this.getOrderInfo()},onLoad:function(){this.getOrderInfo()},methods:{getOrderInfo:function(){var e=this;this.isLoading=!0,this.$api.post("/api/order/cartOrder",{address_id:this.address.id,invoice_info:""},function(i){console.log(i),e.isLoading=!1,200==i.data.code?(e.order=i.data.data,e.goods=i.data.data.goods_info,console.log(i.data.data.address),e.address=i.data.data.address):t.showToast({title:i.data.msg,mask:!0,icon:"none"})})},generateOrder:function(){if(!this.address.id)return t.showToast({title:"请添加一个地址",icon:"none"});var e=this;this.$api.post("/api/order/generateOrder",{pay_way:1,coin:"",address_id:this.address.id,remark:this.remark,invoice_info:this.invoiceData.title?JSON.stringify(this.invoiceData):""},function(i){if(console.log(i),200==i.data.code){var s=i.data.data.order_id;e.doPay(s)}else t.showToast({title:i.data.msg,icon:"none"})})},doPay:function(e){var i=this;this.$api.post("/api/miniprogram.payment/unifiedOrder",{order_id:e},function(s){if(console.log(s),200==s.data.code){var a=s.data.data;a.success=function(){i.isUpdate=!1,setTimeout(function(){t.redirectTo({url:"pay_success/pay_success?id="+e})},300)},a.fail=function(){t.showToast({title:"您取消了支付",icon:"none"}),setTimeout(function(){t.redirectTo({url:"/pages/user/orders/order-detail/order-detail?id="+e})},500)},t.requestPayment(a)}else t.showToast({title:s.data.msg,icon:"none"})})},formSubmit:function(e){console.log(e.detail.value);var i=e.detail.value,s={invoice_type:1,title_type:this.invoiceType,title:i.title,tax_no:i.tax_no,bank:i.bank,bank_no:i.bank_no,address:i.address,phone:i.phone};return console.log(s),1!=this.invoiceType||""!=s.title&&""!=s.tax_no?2==this.invoiceType&&""==s.title?t.showToast({title:"星号项为必填项",icon:"none"}):(this.invoiceData=s,this.invoiceText=1==this.invoiceType?"企业发票":"个人发票",void this.hidePop()):t.showToast({title:"星号项为必填项",icon:"none"})},noInvoice:function(){this.invoiceData={},this.hidePop(),this.invoiceText="本次不开具发票"},setInvoice:function(){this.isInvoice=!this.isInvoice},changeInvType:function(t){this.invoiceType=t,console.log(this.invoiceType)},getRemark:function(t){this.remark=t.detail.value},hidePop:function(){this.popUp=!1,this.isInvoice=!1}}};e.default=o}).call(this,i("543d")["default"])},f5cb:function(t,e,i){"use strict";i("c0c8");var s=n(i("b0ce")),a=n(i("00c2"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,s.default)(a.default))}},[["f5cb","common/runtime","common/vendor"]]]);