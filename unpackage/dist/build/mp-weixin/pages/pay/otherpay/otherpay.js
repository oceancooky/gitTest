(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/pay/otherpay/otherpay"],{"0915":function(t,e,i){"use strict";i.r(e);var a=i("4c02"),s=i.n(a);for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);e["default"]=s.a},"2d21":function(t,e,i){"use strict";i.r(e);var a=i("bd29"),s=i("0915");for(var n in s)"default"!==n&&function(t){i.d(e,t,function(){return s[t]})}(n);i("6fb1");var o=i("2877"),c=Object(o["a"])(s["default"],a["a"],a["b"],!1,null,null,null);e["default"]=c.exports},"4c02":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(i("fa81")),s=n(i("3764"));function n(t){return t&&t.__esModule?t:{default:t}}var o={components:{goodsCard:a.default,loading:s.default},data:function(){return{popUp:!1,isInvoice:!1,order:{},goods:[],address:{},remark:"",isUpdate:!1,invoiceType:1,invoiceData:{},invoiceText:"本次不开具发票",payPop:!1,payway:1,coin:0,realCost:0,field:1,isLoading:!1}},onShow:function(){this.isUpdate&&this.getOrderInfo()},onLoad:function(t){console.log(t.field),this.field=t.field,2==t.field&&(this.payway=4),this.getOrderInfo()},methods:{getOrderInfo:function(){var e=this;this.isLoading=!0,this.$api.post("/api/order/cartOrder",{address_id:this.address.id,invoice_info:""},function(i){if(console.log(i),e.isLoading=!1,200==i.data.code){var a=i.data.data;e.order=a,e.realCost=a.amount,e.goods=a.goods_info,e.address=a.address}else t.showToast({title:i.data.msg,mask:!0,icon:"none"})})},choosePay:function(){this.payPop=!0,this.popUp=!0},changePay:function(t){this.payway=t,1==t&&(this.realCost=this.order.amount),2!=t&&5!=t||(this.coin=this.order.amount),3!=t&&4!=t&&6!=t||(this.coin=0)},getCoin:function(e){var i=e.detail.value,a=100*this.order.cur_coin/100,s=String(i).indexOf(".")+1,n=String(i).length-s;s>0&&n>2?t.showToast({title:"最多输入两位小数，请重新输入",icon:"none"}):i>a?t.showToast({title:"已超过账户可用购物币，请重新输入",icon:"none"}):i>this.order.amount?t.showToast({title:"已超过订单金额，请重新输入",icon:"none"}):(this.coin=i,this.realCost=100*this.order.amount/100-this.coin)},confirmOrder:function(){var e=this;if(2==this.payway){if(this.order.cur_coin<this.order.amount)return t.showToast({title:"当前账户购物币不足，请选用其他方式",icon:"none"});t.showModal({title:"",content:"确认使用"+e.coin+"个购物币支付订单吗?",confirmColor:"#e9101f",success:function(t){t.confirm&&e.generateOrder()}})}else if(3==this.payway){if(0==this.coin)return t.showToast({title:"请输入购物币数量",icon:"none"});t.showModal({title:"",content:"确认使用"+e.coin+"购物币支付订单吗?",confirmColor:"#e9101f",success:function(t){t.confirm&&e.generateOrder()}})}else if(4==this.payway){if(this.order.cur_point<this.order.point_total)return t.showToast({title:"当前账户积分不足，请选择其他支付方式",icon:"none"});e.generateOrder()}else if(5==this.payway){if(this.order.cur_point<this.order.point_total)return t.showToast({title:"当前账户积分不足，请选择其他支付方式",icon:"none"});if(this.order.cur_coin<this.order.amount)return t.showToast({title:"当前购物币不足，请选择其他支付方式",icon:"none"});t.showModal({title:"",content:"确认使用"+this.order.point_total+"积分+"+this.order.amount+"购物币支付订单吗?",confirmColor:"#e9101f",success:function(t){t.confirm&&e.generateOrder()}})}else if(6==this.payway){if(this.order.cur_point<this.order.point_total)return t.showToast({title:"当前账户积分不足，请选择其他支付方式",icon:"none"});e.generateOrder()}else e.generateOrder()},generateOrder:function(){if(!this.address.id&&!this.order.all_sale_flag)return t.showToast({title:"请添加一个地址",icon:"none"});var e=this;this.$api.post("/api/order/generateOrder",{pay_way:this.payway,coin:this.coin,address_id:this.address.id,remark:this.remark,invoice_info:this.invoiceData.title?JSON.stringify(this.invoiceData):""},function(i){if(console.log(i),200==i.data.code){var a=i.data.data.order_id;e.doPay(a)}else if(201==i.data.code){a=i.data.data.order_id;t.showToast({title:"下单成功！"}),setTimeout(function(){t.redirectTo({url:"/pages/pay/pay_success/pay_success?id="+a})},500)}else t.showToast({title:i.data.msg,icon:"none"})})},doPay:function(e){var i=this;this.$api.post("/api/miniprogram.payment/unifiedOrder",{order_id:e},function(a){if(console.log(a),200==a.data.code){var s=a.data.data;s.success=function(){i.isUpdate=!1,setTimeout(function(){t.redirectTo({url:"/pages/pay/pay_success/pay_success?id="+e})},300)},s.fail=function(){t.showToast({title:"您取消了支付",icon:"none"}),setTimeout(function(){t.redirectTo({url:"/pages/user/orders/order-detail/order-detail?id="+e})},500)},t.requestPayment(s)}else t.showToast({title:a.data.msg,icon:"none"})})},formSubmit:function(e){console.log(e.detail.value);var i=e.detail.value,a={invoice_type:1,title_type:this.invoiceType,title:i.title,tax_no:i.tax_no,bank:i.bank,bank_no:i.bank_no,address:i.address,phone:i.phone};return console.log(a),1!=this.invoiceType||""!=a.title&&""!=a.tax_no?2==this.invoiceType&&""==a.title?t.showToast({title:"星号项为必填项",icon:"none"}):(this.invoiceData=a,this.invoiceText=1==this.invoiceType?"企业发票":"个人发票",void this.hidePop()):t.showToast({title:"星号项为必填项",icon:"none"})},noInvoice:function(){this.invoiceData={},this.hidePop(),this.invoiceText="本次不开具发票"},setInvoice:function(){this.isInvoice=!this.isInvoice},changeInvType:function(t){this.invoiceType=t,console.log(this.invoiceType)},getRemark:function(t){this.remark=t.detail.value},hidePop:function(){this.popUp=!1,this.isInvoice=!1,this.payPop=!1}}};e.default=o}).call(this,i("543d")["default"])},"6fb1":function(t,e,i){"use strict";var a=i("99ec"),s=i.n(a);s.a},"99ec":function(t,e,i){},b2c1:function(t,e,i){"use strict";i("c0c8");var a=n(i("b0ce")),s=n(i("2d21"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,a.default)(s.default))},bd29:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{},[t.order.all_sale_flag?t._e():i("block",[t.address.id?i("navigator",{staticClass:"content padding-content flex-con address more more-b more-r",attrs:{url:"/pages/user/address/address?from=1"}},[i("view",{staticClass:"address-edit"}),i("view",{staticClass:"address-info"},[i("view",{staticClass:"address-name flex-con"},[t._v(t._s(t.address.name)),i("view",{staticClass:"address-phone"},[t._v(t._s(t.address.phone))])]),i("view",{staticClass:"address-detail flex-con"},[t._v(t._s(t.address.address))])])]):i("navigator",{staticClass:"content padding-content flex-con address more more-b more-r",attrs:{url:"/pages/user/address/newaddress/newaddress?from=1"}},[i("view",{staticClass:"address-edit"}),i("view",{staticClass:"address-info"},[i("view",{staticClass:"address-detail flex-con"},[t._v("请添加一个地址")])])])],1),i("view",{staticClass:"content martop20 padding-content orders-goods-wrap"},t._l(t.goods,function(t,e){return i("view",{key:e,staticClass:"order-item-goods"},[i("goodsCard",{attrs:{goodsinfo:t,mpcomid:"27da6634-0-"+e}})],1)})),i("view",{staticClass:"content padding-content menu menu-title remark"},[t._v("留言:"),i("input",{attrs:{type:"text",value:"",placeholder:"选填, 请填写其他需求",eventid:"27da6634-0"},on:{input:t.getRemark}})]),t.order.all_sale_flag?t._e():i("view",{staticClass:"content padding-content menu menu-title more more-b more-r invoice",attrs:{eventid:"27da6634-1"},on:{tap:t.setInvoice}},[t._v("发票"),i("view",[t._v(t._s(t.invoiceText))])]),i("view",{staticClass:"content padding-top20"},[i("view",{staticClass:"info-item flex-con justify-bet"},[t._v("商品金额"),i("view",[t._v("￥"+t._s(t.order.goods_total?t.order.goods_total:0))])]),i("view",{staticClass:"info-item flex-con justify-bet"},[t._v("支付方式"),1==t.payway?i("view",[t._v("￥"+t._s(t.order.amount))]):t._e(),2==t.payway?i("view",[t._v(t._s(t.order.amount)+"购物币")]):t._e(),3==t.payway?i("view",[t._v("￥"+t._s(t.realCost)+" + "+t._s(t.coin)+"购物币")]):t._e(),4==t.payway?i("view",[t._v("￥"+t._s(t.order.amount)+" + "+t._s(t.order.point_total)+"积分")]):t._e(),5==t.payway?i("view",[t._v("￥"+t._s(t.order.amount)+"购物币 + "+t._s(t.order.point_total)+"购物币")]):t._e(),6==t.payway?i("view",[t._v("￥"+t._s(t.realCost)+" + "+t._s(t.coin)+"购物币 + "+t._s(t.order.point_total)+"积分")]):t._e()]),i("view",{staticClass:"info-item flex-con justify-bet"},[t._v("运费"),i("view",[t._v("￥"+t._s(t.order.freight?t.order.freight:0))])])]),i("view",{staticClass:"bottom-menu fix-bottom"},[i("view",{staticClass:"bottom-menu-con flex-con justify-bet"},[i("view",{staticClass:"total flex-con"},[t._v("合计"),i("view",{staticClass:"flex-con total-price"},[i("view",{staticClass:"total-price-sym"},[t._v("￥")]),t._v(t._s(t.order.amount?t.order.amount:0))])]),i("button",{attrs:{eventid:"27da6634-2"},on:{tap:t.choosePay}},[t._v("提交订单")])],1)]),t.popUp||t.isInvoice?i("view",{staticClass:"popup",attrs:{eventid:"27da6634-3"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.moveHandle(e)},tap:t.hidePop}}):t._e(),i("view",{staticClass:"select-pop",class:{active:t.popUp},attrs:{eventid:"27da6634-5"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.moveHandle(e)}}},[i("view",{staticClass:"close-btn",attrs:{eventid:"27da6634-4"},on:{tap:t.hidePop}})]),i("view",{staticClass:"select-pop",class:{active:t.isInvoice},attrs:{eventid:"27da6634-11"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.moveHandle(e)}}},[i("view",{staticClass:"close-btn",attrs:{eventid:"27da6634-6"},on:{tap:t.noInvoice}}),i("view",{staticClass:"padding-top20 flex-con font-bold justify-center pay-title"},[t._v("选择发票")]),i("form",{attrs:{eventid:"27da6634-10"},on:{submit:t.formSubmit}},[i("scroll-view",{staticClass:"scrollInvoice",attrs:{"scroll-y":"true"}},[i("view",{staticClass:"selec-title padding-content martop20 font-bold flex-con justify-bet"},[t._v("发票类型")]),i("view",{staticClass:"padding-top20 flex-con"},[i("view",{staticClass:"invoice-type invoice_sel"},[t._v("电子发票")]),i("view",{staticClass:"invoice-type"},[t._v("纸质发票")])]),i("view",{staticClass:"selec-title padding-content font-bold flex-con justify-bet"},[t._v("抬头类型")]),i("view",{staticClass:"padding-top20 flex-con"},[i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:1==t.invoiceType},attrs:{eventid:"27da6634-7"},on:{tap:function(e){t.changeInvType(1)}}},[t._v("单位")]),i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:2==t.invoiceType},attrs:{eventid:"27da6634-8"},on:{tap:function(e){t.changeInvType(2)}}},[t._v("个人")])]),i("view",{staticClass:"padding-content invoice-box"},[i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[i("text",[t._v("*")]),t._v("发票抬头:")]),i("input",{attrs:{type:"text",placeholder:"抬头名称",name:"title"}})]),1==t.invoiceType?i("block",[i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[i("text",[t._v("*")]),t._v("税号:")]),i("input",{attrs:{type:"idcard",placeholder:"纳税人识别号",name:"tax_no"}})]),i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[t._v("开户银行:")]),i("input",{attrs:{type:"text",placeholder:"选填",name:"bank"}})]),i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[t._v("银行账号:")]),i("input",{attrs:{type:"number",placeholder:"选填",name:"bank_no"}})]),i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[t._v("企业地址:")]),i("input",{attrs:{type:"text",placeholder:"选填",name:"address"}})]),i("view",{staticClass:"menu"},[i("view",{staticClass:"menu-name"},[t._v("企业电话:")]),i("input",{attrs:{type:"number",placeholder:"选填",name:"phone"}})])]):t._e(),i("view",{staticClass:"menu more more-b",attrs:{eventid:"27da6634-9"},on:{tap:t.noInvoice}},[i("view",{staticClass:"menu-name"},[t._v("本次不开具发票,继续下单")])])],1)]),i("button",{staticClass:"big-btn confirmbtn",attrs:{formType:"submit"}},[t._v("确定")])],1)],1),i("view",{staticClass:"select-pop",class:{active:t.payPop},attrs:{eventid:"27da6634-22"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.moveHandle(e)}}},[i("view",{staticClass:"close-btn",attrs:{eventid:"27da6634-12"},on:{tap:function(e){t.hidePop()}}}),i("view",{staticClass:"padding-top20 flex-con font-bold justify-center pay-title"},[t._v("选择付款方式")]),1==t.field?i("view",{staticClass:"padding-top20 flex-con"},[i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:1==t.payway},attrs:{eventid:"27da6634-13"},on:{tap:function(e){t.changePay(1)}}},[t._v("现金")]),i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:2==t.payway},attrs:{eventid:"27da6634-14"},on:{tap:function(e){t.changePay(2)}}},[t._v("购物币")]),i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:3==t.payway},attrs:{eventid:"27da6634-15"},on:{tap:function(e){t.changePay(3)}}},[t._v("现金+购物币")])]):t._e(),2==t.field?i("view",{staticClass:"padding-top20 flex-con"},[i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:4==t.payway},attrs:{eventid:"27da6634-16"},on:{tap:function(e){t.changePay(4)}}},[t._v("现金+积分")]),i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:5==t.payway},attrs:{eventid:"27da6634-17"},on:{tap:function(e){t.changePay(5)}}},[t._v("购物币+积分")]),i("view",{staticClass:"invoice-type cansel",class:{invoice_sel:6==t.payway},attrs:{eventid:"27da6634-18"},on:{tap:function(e){t.changePay(6)}}},[t._v("现金+购物币+积分")])]):t._e(),1==t.payway?i("block",[i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("订单金额:")]),i("view",[t._v("￥"+t._s(t.order.amount))])])]):t._e(),2==t.payway?i("block",[i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("购物币:")]),i("view",[t._v(t._s(t.order.amount))])])]):t._e(),3==t.payway?i("block",[i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("订单金额:")]),i("view",[t._v("￥"+t._s(t.realCost))])]),i("view",{staticClass:"menu padding-content"},[i("view",{staticClass:"menu-name font-bold"},[t._v("使用购物币:")]),i("input",{staticClass:"coin-input",attrs:{type:"digit",placeholder:"输入购物币数量",name:"phone",eventid:"27da6634-19"},on:{input:t.getCoin}})])]):t._e(),4==t.payway?i("block",[i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("账户可用积分:")]),i("view",[t._v(t._s(t.order.cur_point))])]),i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("需要消耗积分:")]),i("view",[t._v(t._s(t.order.point_total))])]),i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("应付金额:")]),i("view",[t._v("￥"+t._s(t.order.amount))])])]):t._e(),5==t.payway?i("block",[i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("账户可用积分:")]),i("view",[t._v(t._s(t.order.cur_point))])]),i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("需要消耗积分:")]),i("view",[t._v(t._s(t.order.point_total))])]),i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("账户可用购物币:")]),i("view",[t._v(t._s(t.order.cur_coin))])]),i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("需要消耗购物币:")]),i("view",[t._v(t._s(t.order.amount))])])]):t._e(),6==t.payway?i("block",[i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("账户可用积分:")]),i("view",[t._v(t._s(t.order.cur_point))])]),i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("需要消耗积分:")]),i("view",[t._v(t._s(t.order.point_total))])]),i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("账户可用购物币:")]),i("view",[t._v(t._s(t.order.cur_coin))])]),i("view",{staticClass:"menu padding-content"},[i("view",{staticClass:"menu-name font-bold"},[t._v("使用购物币:")]),i("input",{staticClass:"coin-input",attrs:{type:"digit",placeholder:"输入购物币数量,1购物币=￥1",name:"phone",eventid:"27da6634-20"},on:{input:t.getCoin}})]),i("view",{staticClass:"menu padding-content font-bold"},[i("view",{staticClass:"menu-name"},[t._v("应付金额:")]),i("view",[t._v("￥"+t._s(t.realCost))])])]):t._e(),2==t.payway||3==t.payway?i("view",{staticClass:"padding-content"},[i("view",{staticClass:"tips flex-con justify-end"},[t._v("1购物币=￥1,当前账户可用购物币"+t._s(t.order.cur_coin)+",本次最多可用"+t._s(t.order.amount)+"个购物币")])]):t._e(),i("button",{staticClass:"big-btn confirmbtn",attrs:{eventid:"27da6634-21"},on:{tap:t.confirmOrder}},[t._v("支付")])],1),i("loading",{attrs:{isLoading:t.isLoading,mpcomid:"27da6634-1"}})],1)},s=[];i.d(e,"a",function(){return a}),i.d(e,"b",function(){return s})}},[["b2c1","common/runtime","common/vendor"]]]);